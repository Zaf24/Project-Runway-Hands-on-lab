<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 5.2 ¬∑ Build Flow ‚Äî Generate OTP | GroundCrew.AI Mission Guide</title>
    <style>
        :root {
            --color-bg-main: #f3f2f1;
            --color-primary: #0078d4;
            --color-primary-dark: #005a9e;
            --color-accent-orange: #ff8c00;
            --color-deep-navy: #001f3f;
            --color-text-main: #323130;
            --color-text-muted: #605e5c;
            --radius-lg: 24px;
            --radius-md: 16px;
            --shadow-soft: 0 18px 44px rgba(0, 31, 63, 0.12);
            font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--color-bg-main);
            color: var(--color-text-main);
            line-height: 1.7;
            letter-spacing: 0.01em;
            padding: 0 24px 96px;
        }

        .page-shell {
            max-width: 1100px;
            margin: 0 auto;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(243, 242, 241, 0.92);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 31, 63, 0.08);
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            padding: 16px 0;
        }

        .brand {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--color-deep-navy);
            text-decoration: none;
        }

        .brand img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 10px;
        }

        .nav-links {
            display: flex;
            gap: 14px;
        }

        .nav-links a {
            text-decoration: none;
            font-weight: 500;
            color: var(--color-text-muted);
            padding: 8px 14px;
            border-radius: 12px;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .nav-links a:hover,
        .nav-links a:focus-visible {
            color: var(--color-primary);
            background: rgba(0, 120, 212, 0.12);
        }

        .hero {
            margin-top: 60px;
            padding: 48px;
            background: linear-gradient(135deg, rgba(0, 31, 63, 0.94), rgba(0, 120, 212, 0.92));
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            color: #ffffff;
            text-align: center;
        }

        .hero h1 {
            font-size: clamp(2.2rem, 5vw, 3.2rem);
            margin-bottom: 16px;
        }

        .hero p {
            max-width: 720px;
            margin: 0 auto;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.86);
        }

        .stage-body {
            margin-top: 48px;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 40px 44px;
            display: grid;
            gap: 36px;
        }

        .stage-section h2 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            color: var(--color-deep-navy);
            margin-bottom: 12px;
        }

        .stage-section p {
            color: var(--color-text-muted);
            font-size: 1.05rem;
        }

        .step-card {
            background: rgba(0, 120, 212, 0.05);
            border: 1px solid rgba(0, 31, 63, 0.08);
            border-radius: var(--radius-md);
            padding: 28px;
            display: grid;
            gap: 20px;
            box-shadow: var(--shadow-soft);
        }

        .step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .step-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-deep-navy);
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(0, 120, 212, 0.16);
            color: var(--color-primary-dark);
            font-weight: 700;
        }

        .step-text {
            color: var(--color-text-main);
            font-size: 1.05rem;
        }

        figure {
            display: grid;
            gap: 12px;
        }

        figure img {
            width: 100%;
            border-radius: var(--radius-md);
            border: 1px solid rgba(0, 31, 63, 0.12);
            box-shadow: 0 18px 46px rgba(0, 31, 63, 0.12);
        }

        figure figcaption {
            font-size: 0.95rem;
            color: var(--color-text-muted);
            text-align: center;
        }

        .tip {
            background: rgba(0, 120, 212, 0.1);
            border-left: 4px solid var(--color-primary);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            color: var(--color-text-muted);
            font-size: 0.98rem;
        }

        .warning {
            background: rgba(255, 140, 0, 0.1);
            border-left: 4px solid var(--color-accent-orange);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            color: var(--color-text-main);
            font-size: 0.98rem;
            font-weight: 500;
        }

        .code-block {
            background: rgba(0, 31, 63, 0.05);
            border-left: 4px solid var(--color-primary);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 0.95rem;
            color: var(--color-text-main);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .cta-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin-top: 12px;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 24px;
            border-radius: 999px;
            font-weight: 600;
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .cta-primary {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.92), rgba(0, 90, 158, 0.94));
            color: #ffffff;
            box-shadow: 0 16px 36px rgba(0, 120, 212, 0.32);
        }

        .cta-secondary {
            background: #ffffff;
            color: var(--color-primary-dark);
            border: 1px solid rgba(0, 120, 212, 0.3);
            box-shadow: 0 12px 28px rgba(0, 31, 63, 0.14);
        }

        .cta-button:hover,
        .cta-button:focus-visible {
            transform: translateY(-2px);
            box-shadow: 0 20px 44px rgba(0, 120, 212, 0.35);
        }

        footer {
            margin-top: 72px;
            text-align: center;
            color: var(--color-text-muted);
            font-size: 0.95rem;
        }

        footer a {
            color: var(--color-primary-dark);
            text-decoration: none;
            font-weight: 600;
        }

        @media (max-width: 720px) {
            .hero {
                padding: 36px 24px;
            }

            .stage-body {
                padding: 32px 24px;
            }

            .step-card {
                padding: 24px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="page-shell">
        <header>
            <nav class="nav">
                <a class="brand" href="index.html">
                    <img src="./Images/JTC.jpeg" alt="JTC Logo">
                    JTC AI Day ‚Äì Project Runway ‚úàÔ∏è
                </a>
                <div class="nav-links">
                    <a href="index.html#mission-brief">Mission üìã</a>
                    <a href="index.html#agent-features">Agent ü§ñ</a>
                    <a href="stages.html">Stages üõ´</a>
                </div>
            </nav>
        </header>

        <section class="hero">
            <h1>Step 5.2 ¬∑ Build Flow ‚Äî Generate OTP üîê</h1>
            <p>Create a Power Automate flow that generates a random OTP code, updates the Dataverse table, and sends it via email to the user.</p>
        </section>

        <section class="stage-body">
            <div class="stage-section">
                <h2>Mission Checklist</h2>
                <p>Build a flow that generates a random six-digit OTP code, stores it in the UserVerification table, and sends it to the user's email address for identity verification.</p>
            </div>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Create New Agent Flow</div>
                    <span class="step-number">1</span>
                </div>
                <p class="step-text">
                    On the left navigation pane, select <strong>"Flows"</strong> and click on <strong>"+ New agent flow"</strong>.
                </p>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Configure Flow Trigger and Inputs</div>
                    <span class="step-number">2</span>
                </div>
                <p class="step-text">
                    Choose <strong>"When an agent calls the flow"</strong> and add two inputs:
                </p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--color-text-main);">
                    <li>A <strong>text</strong> input named <strong>"Username"</strong></li>
                    <li>Another <strong>text</strong> input named <strong>"UserEmail"</strong></li>
                </ul>
                <figure>
                    <img src="./Images/Stage 6.2 step 2.png" alt="Flow trigger with Username and UserEmail inputs">
                    <figcaption>Configure the flow trigger with Username and UserEmail inputs.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Initialize Variable for OTP Code</div>
                    <span class="step-number">3</span>
                </div>
                <p class="step-text">
                    Click the <strong>"+"</strong> button below the trigger and add a <strong>"Variable"</strong> &gt; <strong>"Initialize variable"</strong>.
                </p>
                <figure>
                    <img src="./Images/Stage 6.2 step 3.png" alt="Initialize variable node">
                    <figcaption>Add an initialize variable node to store the generated OTP.</figcaption>
                </figure>
                <p class="step-text">
                    Configure the variable with the following:
                </p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--color-text-main);">
                    <li><strong>Name:</strong> GeneratedCode</li>
                    <li><strong>Type:</strong> Integer</li>
                    <li><strong>Value:</strong> Click the <strong>"fx"</strong> button and input this code: <code style="background: rgba(0, 31, 63, 0.05); padding: 2px 6px; border-radius: 4px; font-family: monospace;">rand(100000,999999)</code></li>
                </ul>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Add Dataverse Update Action</div>
                    <span class="step-number">4</span>
                </div>
                <p class="step-text">
                    Add another node below, choose <strong>"Microsoft Dataverse"</strong> and select <strong>"Update a row in selected environment"</strong>.
                </p>
                <div class="tip">
                    If it asks you to sign in to create a new connection, just give the connection any name such as <strong>"Groundcrew"</strong> and click <strong>"Sign in"</strong>.
                </div>
                <p class="step-text">
                    You will then see this node.
                </p>
                <figure>
                    <img src="./Images/Stage 6.2 step 5.png" alt="Update a row in selected environment node">
                    <figcaption>Add the Dataverse update action to store the OTP code.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Configure Dataverse Update</div>
                    <span class="step-number">5</span>
                </div>
                <p class="step-text">
                    Configure the Dataverse node:
                </p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--color-text-main);">
                    <li><strong>Environment:</strong> Use the dropdown panel and choose the same environment that your Dataverse table is stored in</li>
                    <li><strong>Table Name:</strong> Search for the <strong>"UserVerification"</strong> table that you have created and select it</li>
                </ul>
                <div class="warning">
                    ‚ö†Ô∏è Important: Make sure you're using the same environment where you created the UserVerification table in Stage 2.
                </div>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Retrieve Row ID from Power Apps</div>
                    <span class="step-number">6</span>
                </div>
                <p class="step-text">
                    In order to retrieve your row ID, we will have to go to <a href="https://make.powerapps.com" target="_blank" rel="noopener" style="color: var(--color-primary); font-weight: 600;">https://make.powerapps.com</a> and view your UserVerifications table.
                </p>
                <p class="step-text">
                    The GUID is the column named <strong>"UserVerification"</strong>. This is a unique ID created for that row. You can copy it and paste it onto the <strong>"Row ID"</strong> in the connector. Refer to the image below.
                </p>
                <figure>
                    <img src="./Images/Stage 4.1 step 11.png" alt="Power Apps showing UserVerification table with GUID">
                    <figcaption>Copy the GUID from the UserVerification column in Power Apps.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Configure OTP Code Column</div>
                    <span class="step-number">7</span>
                </div>
                <p class="step-text">
                    Once you have retrieved your row ID, paste it onto the <strong>"Row ID"</strong> column in your <strong>"Update row in selected environment"</strong> node, then click on <strong>"Advanced parameters"</strong> and select <strong>"OTP code"</strong>.
                </p>
                <p class="step-text">
                    On the <strong>"OTP code"</strong> column, click the <strong>"lightning"</strong> symbol and input <strong>"GeneratedCode"</strong>.
                </p>
                <figure>
                    <img src="./Images/Stage 6.2 step 7.png" alt="OTP code column configured with GeneratedCode variable">
                    <figcaption>Configure the OTP code column to use the GeneratedCode variable.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Add Send Email Action</div>
                    <span class="step-number">8</span>
                </div>
                <p class="step-text">
                    Below the Dataverse node, add another node. You should add a <strong>"Send an email"</strong> node. Sign in with your demo credentials if asked to sign in and allow access.
                </p>
                <p class="step-text">
                    In the send an email node, configure as follows:
                </p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--color-text-main);">
                    <li><strong>To:</strong> Click on the setting buttons and choose <strong>"Use dynamic content"</strong>, then click the <strong>"lightning"</strong> symbol and select the <strong>"UserEmail"</strong> input that you created</li>
                    <li><strong>Subject:</strong> Verification Code</li>
                    <li><strong>Body:</strong> Your verification code is <em>[insert the generated code here]</em></li>
                </ul>
                <p class="step-text">
                    The node should look like the image below.
                </p>
                <figure>
                    <img src="./Images/Stage 6.2 step 8.png" alt="Send an email node configured with UserEmail and verification code">
                    <figcaption>Configure the email to send the OTP code to the user.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Add Response to Agent</div>
                    <span class="step-number">9</span>
                </div>
                <p class="step-text">
                    Add the final action by clicking the <strong>"+"</strong> button and adding the <strong>"Respond to agent"</strong> node. Click on <strong>"+ Add an output"</strong> and name it <strong>"OTP code"</strong>. For its value, input <strong>"GeneratedCode"</strong>.
                </p>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Publish and Rename Flow</div>
                    <span class="step-number">10</span>
                </div>
                <p class="step-text">
                    Once done, click <strong>"Publish"</strong> and go to the <strong>"Overview"</strong> page. Click <strong>"Edit"</strong> and change the name of the flow from "Untitled" to <strong>"Generate OTP"</strong> and then save the flow.
                </p>
                <figure>
                    <img src="./Images/Stage 6.2 step 10.png" alt="Flow overview page showing Generate OTP flow">
                    <figcaption>Rename the flow to "Generate OTP" in the Overview page.</figcaption>
                </figure>
            </article>

            <article class="step-card">
                <div class="step-header">
                    <div class="step-title">Mission Complete</div>
                    <span class="step-number">11</span>
                </div>
                <p class="step-text">
                    Congratulations! You just built a flow to generate a random six-digit number and send it as an email to the user. Next, we will integrate this flow with the topic!
                </p>
                <div class="tip">
                    Your flow generates a random OTP between 100000 and 999999, stores it in the Dataverse UserVerification table, and emails it to the user for verification.
                </div>
            </article>
        </section>

        <div class="cta-panel">
            <a class="cta-button cta-secondary" href="stage-5-1.html">‚¨ÖÔ∏è Back to Step 5.1</a>
            <a class="cta-button cta-secondary" href="stages.html">üìã Stages Overview</a>
            <a class="cta-button cta-primary" href="stage-5-3.html">Next Step ¬∑ Integrate Flows into Topic ‚û°Ô∏è</a>
        </div>

        <footer>
            Built for JTC AI Day ¬∑ Nov '25 ‚ú® Powered by Microsoft Copilot Studio ü§ñ<br>
            Hands-on guide/site by Zafir ‚Äî Solution Engineer, Microsoft üöÄ<br>
            Agent demo by Lincoln ‚Äî Solution Engineer, Microsoft üöÄ
        </footer>
    </div>
</body>
</html>

